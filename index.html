<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Проверка доступа</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta name="color-scheme" content="dark">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">

  <style>
    :root{
      --bg: rgb(13 17 23);
      --fg: #ffffff;
      --ring: #ffffff;
      --error: #ff3b3b;
      --radius: 8px;
      --radius-sm: 6px;
      --t-fast: .2s;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      min-height:100dvh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;
    }
    .title{margin:0 0 20px;font-weight:600;line-height:1.35}
    .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:16px}
    #flagTarget{margin-bottom:20px}
    .sample{border:2px solid var(--ring);border-radius:var(--radius);transform:rotate(.5turn);display:inline-block;vertical-align:middle}
    #flagOptions{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}
    #flagOptions img.option{
      width:70px;height:48px;cursor:pointer;border-radius:var(--radius-sm);border:2px solid transparent;
      transition: transform var(--t-fast), border-color var(--t-fast);will-change: transform;
    }
    #flagOptions img.option:hover{transform:scale(1.05)}
    @keyframes border-blink{0%{border-color:transparent}10%{border-color:var(--error)}90%{border-color:var(--error)}100%{border-color:transparent}}
    .wrong{animation:border-blink .6s linear 1}
  </style>
</head>
<body>
  <div class="wrap">
    <h2 class="title">
      Подтвердите, что вы не бот.<br>
      Выберите изображение, совпадающее с образцом флага:
    </h2>

    <div id="flagTarget" aria-live="polite"></div>
    <p>Доступные варианты:</p>
    <div id="flagOptions"></div>
  </div>

  <noscript>Чтобы продолжить, включите JavaScript в настройках браузера.</noscript>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const FLAGS = [
        { name: "canada",      src: "assets/flags/canada.png" },
        { name: "uk",          src: "assets/flags/uk.png" },
        { name: "moldova",     src: "assets/flags/moldova.png" },
        { name: "south_korea", src: "assets/flags/south_korea.png" },
        { name: "japan",       src: "assets/flags/japan.png" },
        { name: "germany",     src: "assets/flags/germany.png" }
      ];

      const $target = document.getElementById("flagTarget");
      const $options = document.getElementById("flagOptions");

      function randInt(max){
        if (window.crypto && window.crypto.getRandomValues){
          const arr = new Uint32Array(1);
          window.crypto.getRandomValues(arr);
          return arr[0] % max;
        }
        return Math.floor(Math.random() * max);
      }

      function shuffle(arr){
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--){
          const j = randInt(i + 1);
          const tmp = a[i]; a[i] = a[j]; a[j] = tmp;
        }
        return a;
      }

      const correct = FLAGS[randInt(FLAGS.length)];

      const sample = document.createElement("img");
      sample.className = "sample";
      sample.src = correct.src;
      sample.alt = "Образец флага";
      sample.width = 110;
      sample.height = 70;
      sample.decoding = "async";
      sample.loading = "eager";
      $target.appendChild(sample);

      for (const flag of shuffle(FLAGS)){
        const op = document.createElement("img");
        op.className = "option";
        op.src = flag.src;
        op.alt = "Вариант флага";
        op.decoding = "async";
        op.loading = "lazy";

        op.addEventListener("click", () => {
          if (flag.name === correct.name){
            window.location.href = "home.html";
          } else {
            op.classList.remove("wrong");
            void op.offsetWidth;
            op.classList.add("wrong");
          }
        });

        $options.appendChild(op);
      }
    });
  </script>
</body>
</html>
